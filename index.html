<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>摸球游戏1</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .game-config {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .config-group {
            flex: 1;
            min-width: 200px;
        }
        .ball-count-config {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .count-input {
            flex: 1;
            min-width: 150px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .ball-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            min-height: 100px;
        }
        .ball {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 2px solid rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .ball.highlight {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }
        .red-ball {
            background-color: #FF4444;
        }
        .yellow-ball {
            background-color: #FFD700;
            color: #333;
        }
        .results {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-top: 30px;
        }
        .chart-container {
            flex: 2;
            min-width: 500px;
            height: 400px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            position: relative;
        }
        .chart-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            z-index: 10;
            display: none;
        }
        .stats {
            flex: 1;
            min-width: 250px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .stats h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
        }
        .stats-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stats-item .label {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stats-item .value {
            text-align: right;
        }
        .ball-sample {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        .red-sample {
            background-color: #FF4444;
        }
        .yellow-sample {
            background-color: #FFD700;
        }
        .total-stats {
            background-color: #e3f2fd;
            border-left: 4px solid #3498db;
        }
        .data-display {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e8;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .data-display h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .data-values {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .data-item {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .data-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .data-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s;
        }
        @media (max-width: 768px) {
            .results {
                flex-direction: column;
            }
            .chart-container {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>摸球游戏</h1>
    <div class="game-config">
        <div class="config-group">
            <label for="drawCount">摸球次数:</label>
            <input type="number" id="drawCount" min="1" max="10000" value="100">
        </div>
        <div class="config-group">
            <div class="ball-count-config">
                <div class="count-input">
                    <label for="redCount">红球个数:</label>
                    <input type="number" id="redCount" min="1" max="100" value="5">
                </div>
                <div class="count-input">
                    <label for="yellowCount">黄球个数:</label>
                    <input type="number" id="yellowCount" min="1" max="100" value="5">
                </div>
            </div>
        </div>
        <div class="config-group">
            <button id="startBtn">开始摸球</button>
            <button id="resetBtn" style="background-color: #e74c3c; margin-top: 10px;">重置</button>
        </div>
    </div>
    <div class="progress-bar">
        <div class="progress" id="progressBar"></div>
    </div>
    <div class="ball-pool" id="ballPool">
        <!--球池将通过JavaScript动态生成-->
    </div>
    <div class="results">
        <div class="chart-container">
            <div class="chart-overlay" id="chartOverlay">
                <h3>模拟进行中...</h3>
                <div id="currentProgress">0%</div>
            </div>
            <canvas id="resultChart"></canvas>
        </div>
        <div class="stats" id="stats">
            <h3>统计结果</h3>
            <!--统计信息将通过JavaScript动态生成-->
        </div>
    </div>
    <div class="data-display" id="dataDisplay" style="display: none;">
        <h4>最终摸球数据汇总</h4>
        <div class="data-values" id="dataValues">
            <!--数据将通过JavaScript动态生成-->
        </div>
    </div>
</div>

<script>
    // 固定颜色
    const ballColors = ['#FF4444', '#FFD700']; // 红色和黄色
    const colorNames = ['红球', '黄球'];
    let chart = null;
    let isAnimating = false;
    let animationId = null;

    // DOM元素
    const ballPool = document.getElementById('ballPool');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const drawCountInput = document.getElementById('drawCount');
    const redCountInput = document.getElementById('redCount');
    const yellowCountInput = document.getElementById('yellowCount');
    const statsDiv = document.getElementById('stats');
    const dataDisplay = document.getElementById('dataDisplay');
    const dataValues = document.getElementById('dataValues');
    const progressBar = document.getElementById('progressBar');
    const chartOverlay = document.getElementById('chartOverlay');
    const currentProgress = document.getElementById('currentProgress');

    // 初始化球池
    function initializeBallPool() {
        const redCount = parseInt(redCountInput.value);
        const yellowCount = parseInt(yellowCountInput.value);
        const total = redCount + yellowCount;

        // 清空球池
        ballPool.innerHTML = '';

        // 生成红球
        for (let i = 0; i < redCount; i++) {
            const ball = document.createElement('div');
            ball.className = 'ball red-ball';
            ball.textContent = '红';
            ball.dataset.color = 'red';
            ballPool.appendChild(ball);
        }

        // 生成黄球
        for (let i = 0; i < yellowCount; i++) {
            const ball = document.createElement('div');
            ball.className = 'ball yellow-ball';
            ball.textContent = '黄';
            ball.dataset.color = 'yellow';
            ballPool.appendChild(ball);
        }

        return { redCount, yellowCount, total };
    }

    // 创建初始图表
    function createInitialChart() {
        const ctx = document.getElementById('resultChart').getContext('2d');

        if (chart) {
            chart.destroy();
        }

        chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['红球', '黄球'],
                datasets: [{
                    label: '摸中次数',
                    data: [0, 0],
                    backgroundColor: [ballColors[0], ballColors[1]],
                    borderColor: [ballColors[0], ballColors[1]],
                    borderWidth: 2,
                    barPercentage: 0.6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 500,
                    easing: 'easeOutQuart'
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '摸中次数'
                        },
                        suggestedMax: 10
                    },
                    x: {
                        title: {
                            display: true,
                            text: '球颜色'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.raw;
                                return `摸中次数: ${value}次`;
                            }
                        }
                    },
                    // 在柱状图上显示数值
                    datalabels: {
                        display: true,
                        color: 'black',
                        anchor: 'end',
                        align: 'top',
                        formatter: function(value) {
                            return value;
                        }
                    }
                }
            },
            plugins: [{
                id: 'datalabels',
                afterDatasetsDraw: function(chart) {
                    const ctx = chart.ctx;
                    chart.data.datasets.forEach((dataset, i) => {
                        const meta = chart.getDatasetMeta(i);
                        meta.data.forEach((bar, index) => {
                            const data = dataset.data[index];
                            ctx.fillStyle = 'black';
                            ctx.font = 'bold 14px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText(data, bar.x, bar.y - 10);
                        });
                    });
                }
            }]
        });
    }

    // 模拟摸球(带动画)
    function simulateDrawsWithAnimation(ballCounts) {
        const drawCount = parseInt(drawCountInput.value);
        const results = { red: 0, yellow: 0 };
        const redProbability = ballCounts.redCount / ballCounts.total;
        let currentDraw = 0;
        const balls = ballPool.querySelectorAll('.ball');

        // 显示进度条和覆盖层
        chartOverlay.style.display = 'block';
        progressBar.style.width = '0%';

        function drawNext() {
            if (currentDraw >= drawCount || !isAnimating) {
                // 动画结束
                isAnimating = false;
                chartOverlay.style.display = 'none';
                startBtn.disabled = false;
                resetBtn.disabled = false;
                updateFinalStats(results, ballCounts);
                return;
            }

            // 模拟一次摸球
            const random = Math.random();
            const isRed = random < redProbability;
            const color = isRed ? 'red' : 'yellow';
            results[color]++;

            // 更新图表数据
            chart.data.datasets[0].data = [results.red, results.yellow];

            // 动态调整y轴最大值
            const maxValue = Math.max(results.red, results.yellow, 10);
            chart.options.scales.y.suggestedMax = Math.ceil(maxValue * 1.1);

            // 更新图表
            chart.update();

            // 高亮显示被摸中的球(随机选择一个对应颜色的球)
            const matchingBalls = Array.from(balls).filter(ball => ball.dataset.color === color);
            if (matchingBalls.length > 0) {
                const randomBall = matchingBalls[Math.floor(Math.random() * matchingBalls.length)];
                randomBall.classList.add('highlight');
                setTimeout(() => {
                    randomBall.classList.remove('highlight');
                }, 300);
            }

            // 更新进度
            currentDraw++;
            const progress = (currentDraw / drawCount) * 100;
            progressBar.style.width = progress + '%';
            currentProgress.textContent = Math.round(progress) + '%';

            // 控制动画速度(根据总次数调整)
            const speed = drawCount > 500 ? 0 : drawCount > 100 ? 10 : 50;
            animationId = setTimeout(drawNext, speed);
        }

        // 开始动画
        drawNext();
    }

    // 更新最终统计信息
    function updateFinalStats(results, ballCounts) {
        const drawCount = parseInt(drawCountInput.value);
        const redPercentage = ((results.red / drawCount) * 100).toFixed(2);
        const yellowPercentage = ((results.yellow / drawCount) * 100).toFixed(2);

        statsDiv.innerHTML = `
        <h3>最终统计结果</h3>
        <div class="stats-item">
            <div class="label">
                <span class="ball-sample red-sample"></span>
                红球摸中次数:
            </div>
            <div class="value">
                ${results.red}次 (${redPercentage}%)
            </div>
        </div>
        <div class="stats-item">
            <div class="label">
                <span class="ball-sample yellow-sample"></span>
                黄球摸中次数:
            </div>
            <div class="value">
                ${results.yellow}次 (${yellowPercentage}%)
            </div>
        </div>
        <div class="stats-item total-stats">
            <div class="label">总摸球次数:</div>
            <div class="value">${drawCount}次</div>
        </div>
        <div class="stats-item total-stats">
            <div class="label">球池总数:</div>
            <div class="value">${ballCounts.total}个 (红:${ballCounts.redCount} 黄:${ballCounts.yellowCount})</div>
        </div>
    `;

        // 更新数据展示区域
        dataDisplay.style.display = 'block';
        dataValues.innerHTML = `
        <div class="data-item">
            <div class="data-value" style="color: #FF4444;">${results.red}</div>
            <div class="data-label">红球摸中次数</div>
        </div>
        <div class="data-item">
            <div class="data-value" style="color: #FFD700;">${results.yellow}</div>
            <div class="data-label">黄球摸中次数</div>
        </div>
        <div class="data-item">
            <div class="data-value" style="color: #3498db;">${drawCount}</div>
            <div class="data-label">总摸球次数</div>
        </div>
        <div class="data-item">
            <div class="data-value" style="color: #4CAF50;">${redPercentage}%</div>
            <div class="data-label">红球摸中概率</div>
        </div>
        <div class="data-item">
            <div class="data-value" style="color: #4CAF50;">${yellowPercentage}%</div>
            <div class="data-label">黄球摸中概率</div>
        </div>
    `;
    }

    // 开始摸球游戏
    function startGame() {
        if (isAnimating) return;

        isAnimating = true;
        startBtn.disabled = true;
        resetBtn.disabled = true;

        const ballCounts = initializeBallPool();
        createInitialChart();
        simulateDrawsWithAnimation(ballCounts);
    }

    // 重置游戏
    function resetGame() {
        if (isAnimating) {
            isAnimating = false;
            clearTimeout(animationId);
        }

        startBtn.disabled = false;
        resetBtn.disabled = false;
        chartOverlay.style.display = 'none';
        progressBar.style.width = '0%';

        initializeBallPool();
        createInitialChart();
        statsDiv.innerHTML = '<h3>统计结果</h3><p>请点击"开始摸球"按钮开始模拟</p>';
        dataDisplay.style.display = 'none';
    }

    // 事件监听
    startBtn.addEventListener('click', startGame);
    resetBtn.addEventListener('click', resetGame);

    // 初始化页面
    window.addEventListener('DOMContentLoaded', () => {
        initializeBallPool();
        createInitialChart();
        statsDiv.innerHTML = '<h3>统计结果</h3><p>请点击"开始摸球"按钮开始模拟</p>';
    });
</script>
</body>
</html>

